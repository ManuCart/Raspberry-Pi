#!/bin/sh
# sudo apt-get install imagemagick
# sudo npm install sharp-cli -g
# export NODE_PATH=~/node_modules/
FILES=/media/hdd/photos/1907
#mkdir $FILES
#mkdir /media/hdd/tmp
#rsync --archive --delete --info=progress2 /media/hdd/photos/ $FILES
find $FILES -iname "*.JPG" -type f | sort | while read FILE ; do
  NEWFILE="W`echo "$(basename "$FILE")" | cut -c 2-`"
  echo " ### $FILE"



    r=`file "$FILE" | cut -d ',' -f  12 | cut -c2-`
W=`echo "$r" | cut -d 'x' -f 1`
H=`echo "$r" | cut -d 'x' -f 2`
  #echo "Height : $H"
  #echo "Width : $W"
echo " ### $(basename "$FILE") >>> $NEWFILE - $r - | $W | $H |"
echo " ### $(basename "$FILE") >>> $NEWFILE - $r - | $W | $H |" >> ~/test.log

  #if [ $1 -gt 2048 -o $2 -gt 2048 ] ; then
  #  sharp -i "$FILE" -o /media/hdd/tmp/ resize 2048 2048 --max --withoutEnlargement --withMetadata
  #  rm "$FILE"
  #  mv /media/hdd/tmp/*.JPG "$(dirname "$FILE")/$NEWFILE"
  #else
  #  mv "$FILE" "$(dirname "$FILE")/$NEWFILE"
  #fi
done
#~/scripts/iftt-maker "Backup Photos Web" "Resize Finished"
